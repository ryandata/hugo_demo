import katex from"../katex.mjs";var findEndOfMath=function(t,n,s){for(var i,o=s,a=0,r=t.length;o<n.length;){if(i=n[o],a<=0&&n.slice(o,o+r)===t)return o;i==="\\"?o++:i==="{"?a++:i==="}"&&a--,o++}return-1},escapeRegex=function(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")},amsRegex=/^\\begin{/,splitAtDelimiters=function(t,n){for(var s,o,a,r,i=[],c=new RegExp("("+n.map(e=>escapeRegex(e.left)).join("|")+")");!0;){if(s=t.search(c),s===-1)break;if(s>0&&(i.push({type:"text",data:t.slice(0,s)}),t=t.slice(s)),o=n.findIndex(e=>t.startsWith(e.left)),s=findEndOfMath(n[o].right,t,n[o].left.length),s===-1)break;a=t.slice(0,s+n[o].right.length),r=amsRegex.test(a)?a:t.slice(n[o].left.length,s),i.push({type:"math",data:r,rawData:a,display:n[o].display}),t=t.slice(s+n[o].right.length)}return t!==""&&i.push({type:"text",data:t}),i},renderMathInText=function(t,n){var o,i,a,r,s=splitAtDelimiters(t,n.delimiters);if(s.length===1&&s[0].type==="text")return null;for(i=document.createDocumentFragment(),o=0;o<s.length;o++)if(s[o].type==="text")i.appendChild(document.createTextNode(s[o].data));else{r=document.createElement("span"),a=s[o].data,n.displayMode=s[o].display;try{n.preProcess&&(a=n.preProcess(a)),katex.render(a,r,n)}catch(e){if(!(e instanceof katex.ParseError))throw e;n.errorCallback("KaTeX auto-render: Failed to parse `"+s[o].data+"` with ",e),i.appendChild(document.createTextNode(s[o].rawData));continue}i.appendChild(r)}return i},renderElem=function e(t,n){for(var s,o,a,r,c,l,i=0;i<t.childNodes.length;i++)if(s=t.childNodes[i],s.nodeType===3){for(c=s.textContent,o=s.nextSibling,a=0;o&&o.nodeType===Node.TEXT_NODE;)c+=o.textContent,o=o.nextSibling,a++;if(r=renderMathInText(c,n),r){for(l=0;l<a;l++)s.nextSibling.remove();i+=r.childNodes.length-1,t.replaceChild(r,s)}else i+=a}else s.nodeType===1&&function(){var t=" "+s.className+" ",o=n.ignoredTags.indexOf(s.nodeName.toLowerCase())===-1&&n.ignoredClasses.every(e=>t.indexOf(" "+e+" ")===-1);o&&e(s,n)}()},renderMathInElement=function(t,n){if(!t)throw new Error("No element provided to render");var o,s={};for(o in n)n.hasOwnProperty(o)&&(s[o]=n[o]);s.delimiters=s.delimiters||[{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\begin{CD}",right:"\\end{CD}",display:!0},{left:"\\[",right:"\\]",display:!0}],s.ignoredTags=s.ignoredTags||["script","noscript","style","textarea","pre","code","option"],s.ignoredClasses=s.ignoredClasses||[],s.errorCallback=s.errorCallback||console.error,s.macros=s.macros||{},renderElem(t,s)};export{renderMathInElement as default}