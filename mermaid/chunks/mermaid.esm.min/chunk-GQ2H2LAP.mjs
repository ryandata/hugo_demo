import{c as A,d as q,e as M}from"./chunk-YHTUPJJ6.mjs";import{a as j}from"./chunk-S67DUUA5.mjs";import{a as N}from"./chunk-LM6QDVU5.mjs";import{d as Z}from"./chunk-VYR5KMM2.mjs";import{m as L}from"./chunk-DPGYIDQ4.mjs";import{Da as U,G as Y,Ha as O,X as g,b as d,ga as W}from"./chunk-4FDTN4JQ.mjs";import{a as f}from"./chunk-GTKDMUJJ.mjs";var V=f((r,t,a,o,l)=>{t.arrowTypeStart&&G(r,"start",t.arrowTypeStart,a,o,l),t.arrowTypeEnd&&G(r,"end",t.arrowTypeEnd,a,o,l)},"addEdgeMarkers"),D={arrow_cross:"cross",arrow_point:"point",arrow_barb:"barb",arrow_circle:"circle",aggregation:"aggregation",extension:"extension",composition:"composition",dependency:"dependency",lollipop:"lollipop"},G=f((r,t,a,o,l,i)=>{let s=D[a];if(!s){d.warn(`Unknown arrow type: ${a}`);return}let n=t==="start"?"Start":"End";r.attr(`marker-${t}`,`url(${o}#${l}_${i}-${s}${n})`)},"addEdgeMarker");var v=new Map,y=new Map,Tt=f(()=>{v.clear(),y.clear()},"clear"),S=f(r=>r?r.reduce((a,o)=>a+";"+o,""):"","getLabelStyles"),vt=f(async(r,t)=>{let a=Y(g().flowchart.htmlLabels),o=await Z(r,t.label,{style:S(t.labelStyle),useHtmlLabels:a,addSvgBackground:!0,isNode:!1});d.info("abc82",t,t.labelType);let l=r.insert("g").attr("class","edgeLabel"),i=l.insert("g").attr("class","label");i.node().appendChild(o);let s=o.getBBox();if(a){let e=o.children[0],p=W(o);s=e.getBoundingClientRect(),p.attr("width",s.width),p.attr("height",s.height)}i.attr("transform","translate("+-s.width/2+", "+-s.height/2+")"),v.set(t.id,l),t.width=s.width,t.height=s.height;let n;if(t.startLabelLeft){let e=await M(t.startLabelLeft,S(t.labelStyle)),p=r.insert("g").attr("class","edgeTerminals"),h=p.insert("g").attr("class","inner");n=h.node().appendChild(e);let c=e.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),y.get(t.id)||y.set(t.id,{}),y.get(t.id).startLeft=p,T(n,t.startLabelLeft)}if(t.startLabelRight){let e=await M(t.startLabelRight,S(t.labelStyle)),p=r.insert("g").attr("class","edgeTerminals"),h=p.insert("g").attr("class","inner");n=p.node().appendChild(e),h.node().appendChild(e);let c=e.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),y.get(t.id)||y.set(t.id,{}),y.get(t.id).startRight=p,T(n,t.startLabelRight)}if(t.endLabelLeft){let e=await M(t.endLabelLeft,S(t.labelStyle)),p=r.insert("g").attr("class","edgeTerminals"),h=p.insert("g").attr("class","inner");n=h.node().appendChild(e);let c=e.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),p.node().appendChild(e),y.get(t.id)||y.set(t.id,{}),y.get(t.id).endLeft=p,T(n,t.endLabelLeft)}if(t.endLabelRight){let e=await M(t.endLabelRight,S(t.labelStyle)),p=r.insert("g").attr("class","edgeTerminals"),h=p.insert("g").attr("class","inner");n=h.node().appendChild(e);let c=e.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),p.node().appendChild(e),y.get(t.id)||y.set(t.id,{}),y.get(t.id).endRight=p,T(n,t.endLabelRight)}return o},"insertEdgeLabel");function T(r,t){g().flowchart.htmlLabels&&r&&(r.style.width=t.length*9+"px",r.style.height="12px")}f(T,"setTerminalWidth");var _t=f((r,t)=>{d.debug("Moving label abc88 ",r.id,r.label,v.get(r.id),t);let a=t.updatedPath?t.updatedPath:t.originalPath,o=g(),{subGraphTitleTotalMargin:l}=N(o);if(r.label){let i=v.get(r.id),s=r.x,n=r.y;if(a){let e=L.calcLabelPosition(a);d.debug("Moving label "+r.label+" from (",s,",",n,") to (",e.x,",",e.y,") abc88"),t.updatedPath&&(s=e.x,n=e.y)}i.attr("transform",`translate(${s}, ${n+l/2})`)}if(r.startLabelLeft){let i=y.get(r.id).startLeft,s=r.x,n=r.y;if(a){let e=L.calcTerminalLabelPosition(r.arrowTypeStart?10:0,"start_left",a);s=e.x,n=e.y}i.attr("transform",`translate(${s}, ${n})`)}if(r.startLabelRight){let i=y.get(r.id).startRight,s=r.x,n=r.y;if(a){let e=L.calcTerminalLabelPosition(r.arrowTypeStart?10:0,"start_right",a);s=e.x,n=e.y}i.attr("transform",`translate(${s}, ${n})`)}if(r.endLabelLeft){let i=y.get(r.id).endLeft,s=r.x,n=r.y;if(a){let e=L.calcTerminalLabelPosition(r.arrowTypeEnd?10:0,"end_left",a);s=e.x,n=e.y}i.attr("transform",`translate(${s}, ${n})`)}if(r.endLabelRight){let i=y.get(r.id).endRight,s=r.x,n=r.y;if(a){let e=L.calcTerminalLabelPosition(r.arrowTypeEnd?10:0,"end_right",a);s=e.x,n=e.y}i.attr("transform",`translate(${s}, ${n})`)}},"positionEdgeLabel"),K=f((r,t)=>{let a=r.x,o=r.y,l=Math.abs(t.x-a),i=Math.abs(t.y-o),s=r.width/2,n=r.height/2;return l>=s||i>=n},"outsideNode"),P=f((r,t,a)=>{d.debug(`intersection calc abc89:
  outsidePoint: ${JSON.stringify(t)}
  insidePoint : ${JSON.stringify(a)}
  node        : x:${r.x} y:${r.y} w:${r.width} h:${r.height}`);let o=r.x,l=r.y,i=Math.abs(o-a.x),s=r.width/2,n=a.x<t.x?s-i:s+i,e=r.height/2,p=Math.abs(t.y-a.y),h=Math.abs(t.x-a.x);if(Math.abs(l-t.y)*s>Math.abs(o-t.x)*e){let c=a.y<t.y?t.y-e-l:l-e-t.y;n=h*c/p;let m={x:a.x<t.x?a.x+n:a.x-h+n,y:a.y<t.y?a.y+p-c:a.y-p+c};return n===0&&(m.x=t.x,m.y=t.y),h===0&&(m.x=t.x),p===0&&(m.y=t.y),d.debug(`abc89 top/bottom calc, Q ${p}, q ${c}, R ${h}, r ${n}`,m),m}else{a.x<t.x?n=t.x-s-o:n=o-s-t.x;let c=p*n/h,m=a.x<t.x?a.x+h-n:a.x-h+n,x=a.y<t.y?a.y+c:a.y-c;return d.debug(`sides calc abc89, Q ${p}, q ${c}, R ${h}, r ${n}`,{_x:m,_y:x}),n===0&&(m=t.x,x=t.y),h===0&&(m=t.x),p===0&&(x=t.y),{x:m,y:x}}},"intersection"),F=f((r,t)=>{d.warn("abc88 cutPathAtIntersect",r,t);let a=[],o=r[0],l=!1;return r.forEach(i=>{if(d.info("abc88 checking point",i,t),!K(t,i)&&!l){let s=P(t,o,i);d.debug("abc88 inside",i,o,s),d.debug("abc88 intersection",s,t);let n=!1;a.forEach(e=>{n=n||e.x===s.x&&e.y===s.y}),a.some(e=>e.x===s.x&&e.y===s.y)?d.warn("abc88 no intersect",s,a):a.push(s),l=!0}else d.warn("abc88 outside",i,o),o=i,l||a.push(i)}),d.debug("returning points",a),a},"cutPathAtIntersect");function tt(r){let t=[],a=[];for(let o=1;o<r.length-1;o++){let l=r[o-1],i=r[o],s=r[o+1];(l.x===i.x&&i.y===s.y&&Math.abs(i.x-s.x)>5&&Math.abs(i.y-l.y)>5||l.y===i.y&&i.x===s.x&&Math.abs(i.x-l.x)>5&&Math.abs(i.y-s.y)>5)&&(t.push(i),a.push(o))}return{cornerPoints:t,cornerPointPositions:a}}f(tt,"extractCornerPoints");var I=f(function(r,t,a){let o=t.x-r.x,l=t.y-r.y,i=Math.sqrt(o*o+l*l),s=a/i;return{x:t.x-s*o,y:t.y-s*l}},"findAdjacentPoint"),rt=f(function(r){let{cornerPointPositions:t}=tt(r),a=[];for(let o=0;o<r.length;o++)if(t.includes(o)){let l=r[o-1],i=r[o+1],s=r[o],n=I(l,s,5),e=I(i,s,5),p=e.x-n.x,h=e.y-n.y;a.push(n);let c=Math.sqrt(2)*2,m={x:s.x,y:s.y};if(Math.abs(i.x-l.x)>10&&Math.abs(i.y-l.y)>=10){d.debug("Corner point fixing",Math.abs(i.x-l.x),Math.abs(i.y-l.y));let x=5;s.x===n.x?m={x:p<0?n.x-x+c:n.x+x-c,y:h<0?n.y-c:n.y+c}:m={x:p<0?n.x-c:n.x+c,y:h<0?n.y-x+c:n.y+x-c}}else d.debug("Corner point skipping fixing",Math.abs(i.x-l.x),Math.abs(i.y-l.y));a.push(m,e)}else a.push(r[o]);return a},"fixCorners"),Bt=f(function(r,t,a,o,l,i,s){let{handDrawnSeed:n}=g(),e=t.points,p=!1,h=l;var c=i;let m=[];for(let b in t.cssCompiledStyles)A(b)||m.push(t.cssCompiledStyles[b]);c.intersect&&h.intersect&&(e=e.slice(1,t.points.length-1),e.unshift(h.intersect(e[0])),d.debug("Last point APA12",t.start,"-->",t.end,e[e.length-1],c,c.intersect(e[e.length-1])),e.push(c.intersect(e[e.length-1]))),t.toCluster&&(d.info("to cluster abc88",a.get(t.toCluster)),e=F(t.points,a.get(t.toCluster).node),p=!0),t.fromCluster&&(d.debug("from cluster abc88",a.get(t.fromCluster),JSON.stringify(e,null,2)),e=F(e.reverse(),a.get(t.fromCluster).node).reverse(),p=!0);let x=e.filter(b=>!Number.isNaN(b.y));x=rt(x);let R=O;t.curve&&(R=t.curve);let{x:J,y:Q}=j(t),z=U().x(J).y(Q).curve(R),k;switch(t.thickness){case"normal":k="edge-thickness-normal";break;case"thick":k="edge-thickness-thick";break;case"invisible":k="edge-thickness-invisible";break;default:k="edge-thickness-normal"}switch(t.pattern){case"solid":k+=" edge-pattern-solid";break;case"dotted":k+=" edge-pattern-dotted";break;case"dashed":k+=" edge-pattern-dashed";break;default:k+=" edge-pattern-solid"}let u,X=z(x),E=Array.isArray(t.style)?t.style:[t.style];if(t.look==="handDrawn"){let b=q.svg(r);Object.assign([],x);let C=b.path(X,{roughness:.3,seed:n});k+=" transition",u=W(C).select("path").attr("id",t.id).attr("class"," "+k+(t.classes?" "+t.classes:"")).attr("style",E?E.reduce((B,H)=>B+";"+H,""):"");let w=u.attr("d");u.attr("d",w),r.node().appendChild(u.node())}else{let b=m.join(";"),C=E?E.reduce((B,H)=>B+H+";",""):"",w="";t.animate&&(w=" edge-animation-fast"),t.animation&&(w=" edge-animation-"+t.animation),u=r.append("path").attr("d",X).attr("id",t.id).attr("class"," "+k+(t.classes?" "+t.classes:"")+(w||"")).attr("style",b?b+";"+C+";":C)}let $="";(g().flowchart.arrowMarkerAbsolute||g().state.arrowMarkerAbsolute)&&($=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,$=$.replace(/\(/g,"\\(").replace(/\)/g,"\\)")),d.info("arrowTypeStart",t.arrowTypeStart),d.info("arrowTypeEnd",t.arrowTypeEnd),V(u,t,$,s,o);let _={};return p&&(_.updatedPath=e),_.originalPath=t.points,_},"insertEdge");var at=f((r,t,a,o)=>{t.forEach(l=>{ft[l](r,a,o)})},"insertMarkers"),et=f((r,t,a)=>{d.trace("Making markers for ",a),r.append("defs").append("marker").attr("id",a+"_"+t+"-extensionStart").attr("class","marker extension "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),r.append("defs").append("marker").attr("id",a+"_"+t+"-extensionEnd").attr("class","marker extension "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},"extension"),st=f((r,t,a)=>{r.append("defs").append("marker").attr("id",a+"_"+t+"-compositionStart").attr("class","marker composition "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",a+"_"+t+"-compositionEnd").attr("class","marker composition "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"composition"),nt=f((r,t,a)=>{r.append("defs").append("marker").attr("id",a+"_"+t+"-aggregationStart").attr("class","marker aggregation "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",a+"_"+t+"-aggregationEnd").attr("class","marker aggregation "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},"aggregation"),ot=f((r,t,a)=>{r.append("defs").append("marker").attr("id",a+"_"+t+"-dependencyStart").attr("class","marker dependency "+t).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),r.append("defs").append("marker").attr("id",a+"_"+t+"-dependencyEnd").attr("class","marker dependency "+t).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},"dependency"),it=f((r,t,a)=>{r.append("defs").append("marker").attr("id",a+"_"+t+"-lollipopStart").attr("class","marker lollipop "+t).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6),r.append("defs").append("marker").attr("id",a+"_"+t+"-lollipopEnd").attr("class","marker lollipop "+t).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)},"lollipop"),lt=f((r,t,a)=>{r.append("marker").attr("id",a+"_"+t+"-pointEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),r.append("marker").attr("id",a+"_"+t+"-pointStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"point"),ct=f((r,t,a)=>{r.append("marker").attr("id",a+"_"+t+"-circleEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),r.append("marker").attr("id",a+"_"+t+"-circleStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},"circle"),pt=f((r,t,a)=>{r.append("marker").attr("id",a+"_"+t+"-crossEnd").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),r.append("marker").attr("id",a+"_"+t+"-crossStart").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},"cross"),ht=f((r,t,a)=>{r.append("defs").append("marker").attr("id",a+"_"+t+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","userSpaceOnUse").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"barb"),ft={extension:et,composition:st,aggregation:nt,dependency:ot,lollipop:it,point:lt,circle:ct,cross:pt,barb:ht},Xt=at;export{Tt as a,vt as b,_t as c,Bt as d,Xt as e};
